# ğŸ—ï¸ ThaparMarket Architecture

## System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER DEVICES                             â”‚
â”‚                  (Web Browser - Desktop/Mobile)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ HTTPS
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FRONTEND (Vercel)                           â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Next.js 14 Application                       â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  â€¢ React Components (Shadcn/UI)                          â”‚  â”‚
â”‚  â”‚  â€¢ Tailwind CSS Styling                                  â”‚  â”‚
â”‚  â”‚  â€¢ React Query (Data Fetching)                           â”‚  â”‚
â”‚  â”‚  â€¢ Zustand (State Management)                            â”‚  â”‚
â”‚  â”‚  â€¢ Socket.io Client (Real-time)                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚                   â”‚
                     â”‚ REST API          â”‚ WebSocket
                     â”‚                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BACKEND (Render)                              â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           Node.js + Express + TypeScript                  â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚   Routes    â”‚  â”‚ Controllers  â”‚  â”‚   Services     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚             â”‚  â”‚              â”‚  â”‚                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Auth      â”‚â†’ â”‚ â€¢ Auth       â”‚â†’ â”‚ â€¢ JWT          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Listings  â”‚  â”‚ â€¢ Listings   â”‚  â”‚ â€¢ Email        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Messages  â”‚  â”‚ â€¢ Messages   â”‚  â”‚ â€¢ Cloudinary   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Users     â”‚  â”‚ â€¢ Users      â”‚  â”‚                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Ratings   â”‚  â”‚ â€¢ Ratings    â”‚  â”‚                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Admin     â”‚  â”‚ â€¢ Admin      â”‚  â”‚                â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚              Middleware Layer                        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                                                      â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Authentication (JWT)                             â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Validation (Joi)                                 â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ File Upload (Multer)                             â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Error Handling                                   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Rate Limiting                                    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Security (Helmet, CORS)                          â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚              Socket.IO Server                        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                                                      â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Real-time Chat                                   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Typing Indicators                                â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Online Status                                    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Notifications                                    â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                 â”‚                 â”‚
       â”‚                 â”‚                 â”‚
       â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DATABASE   â”‚  â”‚  CLOUDINARY â”‚  â”‚   EMAIL (SMTP)  â”‚
â”‚              â”‚  â”‚             â”‚  â”‚                 â”‚
â”‚ Supabase         â”‚  â”‚ Image CDN   â”‚  â”‚ Gmail           â”‚
â”‚ PostgreSQL   â”‚  â”‚             â”‚  â”‚                 â”‚
â”‚              â”‚  â”‚ â€¢ Upload    â”‚  â”‚ â€¢ Verification  â”‚
â”‚ â€¢ Users      â”‚  â”‚ â€¢ Optimize  â”‚  â”‚ â€¢ Welcome       â”‚
â”‚ â€¢ Listings   â”‚  â”‚ â€¢ Transform â”‚  â”‚ â€¢ Password Resetâ”‚
â”‚ â€¢ Messages   â”‚  â”‚ â€¢ Delete    â”‚  â”‚ â€¢ Notifications â”‚
â”‚ â€¢ Ratings    â”‚  â”‚             â”‚  â”‚                 â”‚
â”‚ â€¢ Categories â”‚  â”‚ 25GB Free   â”‚  â”‚ Free            â”‚
â”‚ â€¢ Reports    â”‚  â”‚             â”‚  â”‚                 â”‚
â”‚              â”‚  â”‚             â”‚  â”‚                 â”‚
â”‚ 3GB Free     â”‚  â”‚             â”‚  â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Examples

### 1. User Registration Flow

```
User â†’ Frontend â†’ Backend â†’ Database
                    â†“
                  Email Service â†’ User's Email
                    â†“
User enters OTP â†’ Backend â†’ Database (verify)
                    â†“
                  JWT Token â†’ Frontend â†’ User logged in
```

### 2. Create Listing Flow

```
User uploads images â†’ Frontend
                        â†“
                    Backend (Multer)
                        â†“
                    Cloudinary (store images)
                        â†“
                    Get image URLs
                        â†“
                    Database (save listing with URLs)
                        â†“
                    Return success â†’ Frontend
```

### 3. Real-time Chat Flow

```
User A sends message â†’ Frontend (Socket.io client)
                         â†“
                      Backend (Socket.io server)
                         â†“
                      Database (save message)
                         â†“
                      Emit to User B's socket
                         â†“
                      User B receives message (real-time)
```

### 4. Search & Filter Flow

```
User enters search â†’ Frontend
                       â†“
                    Backend API
                       â†“
                    PostgreSQL Full-text Search
                       â†“
                    Apply filters (category, price, etc.)
                       â†“
                    Return paginated results
                       â†“
                    Frontend displays listings
```

## Technology Stack Details

### Frontend Stack
```
Next.js 14 (App Router)
â”œâ”€â”€ React 18
â”œâ”€â”€ TypeScript
â”œâ”€â”€ Tailwind CSS
â”œâ”€â”€ Shadcn/UI Components
â”œâ”€â”€ React Query (Data fetching)
â”œâ”€â”€ Zustand (State management)
â”œâ”€â”€ Socket.io-client (Real-time)
â”œâ”€â”€ Axios (HTTP client)
â””â”€â”€ React Hook Form (Forms)
```

### Backend Stack
```
Node.js + Express
â”œâ”€â”€ TypeScript
â”œâ”€â”€ PostgreSQL (Supabase)
â”œâ”€â”€ Socket.IO (Real-time)
â”œâ”€â”€ JWT (Authentication)
â”œâ”€â”€ Bcrypt (Password hashing)
â”œâ”€â”€ Multer (File uploads)
â”œâ”€â”€ Cloudinary SDK (Image management)
â”œâ”€â”€ Nodemailer (Email)
â”œâ”€â”€ Joi (Validation)
â”œâ”€â”€ Helmet (Security)
â””â”€â”€ Winston (Logging)
```

### Database Schema
```
PostgreSQL (Supabase)
â”œâ”€â”€ users (Authentication & Profiles)
â”œâ”€â”€ categories (Marketplace categories)
â”œâ”€â”€ listings (Products/Items)
â”œâ”€â”€ messages (Chat messages)
â”œâ”€â”€ ratings (User reviews)
â”œâ”€â”€ favorites (Saved items)
â”œâ”€â”€ reports (Content moderation)
â””â”€â”€ notifications (User alerts)
```

## Security Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 1: Network Security              â”‚
â”‚  â€¢ HTTPS/TLS encryption                 â”‚
â”‚  â€¢ CORS configuration                   â”‚
â”‚  â€¢ Rate limiting (100 req/15min)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 2: Application Security          â”‚
â”‚  â€¢ Helmet.js security headers           â”‚
â”‚  â€¢ Input validation (Joi)               â”‚
â”‚  â€¢ SQL injection protection             â”‚
â”‚  â€¢ XSS protection                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 3: Authentication                â”‚
â”‚  â€¢ JWT tokens (7-day expiry)            â”‚
â”‚  â€¢ Bcrypt password hashing              â”‚
â”‚  â€¢ Email verification (OTP)             â”‚
â”‚  â€¢ Campus email validation              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 4: Authorization                 â”‚
â”‚  â€¢ Role-based access (User/Admin)       â”‚
â”‚  â€¢ Resource ownership validation        â”‚
â”‚  â€¢ Admin-only routes protection         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Deployment Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Production Environment               â”‚
â”‚                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   Vercel    â”‚         â”‚    Render    â”‚       â”‚
â”‚  â”‚  (Frontend) â”‚â—„â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  (Backend)   â”‚       â”‚
â”‚  â”‚             â”‚         â”‚              â”‚       â”‚
â”‚  â”‚  â€¢ Next.js  â”‚         â”‚  â€¢ Express   â”‚       â”‚
â”‚  â”‚  â€¢ CDN      â”‚         â”‚  â€¢ Socket.IO â”‚       â”‚
â”‚  â”‚  â€¢ SSL      â”‚         â”‚  â€¢ SSL       â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                 â”‚                â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                    â”‚            â”‚            â”‚   â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”
â”‚              â”‚   Supabase   â”‚  â”‚Cloudinaryâ”‚ â”‚ Gmail â”‚
â”‚              â”‚PostgreSQLâ”‚  â”‚   CDN    â”‚  â”‚ SMTP â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

All services on FREE tier! ğŸ‰
```

## Performance Optimizations

### Frontend
- âœ… React Query caching (5-10 min)
- âœ… Image lazy loading
- âœ… Code splitting (Next.js automatic)
- âœ… Static generation where possible
- âœ… Optimized images (WebP, AVIF)

### Backend
- âœ… Database connection pooling
- âœ… Indexed database queries
- âœ… Pagination (limit results)
- âœ… Cloudinary image optimization
- âœ… Gzip compression

### Database
- âœ… Indexes on frequently queried columns
- âœ… Full-text search indexes
- âœ… Foreign key constraints
- âœ… Efficient query design

---

**This architecture supports:**
- ğŸ“ˆ Thousands of concurrent users
- ğŸ’¬ Real-time messaging
- ğŸ–¼ï¸ Efficient image delivery
- ğŸ”’ Enterprise-grade security
- ğŸ’° $0/month cost on free tiers
